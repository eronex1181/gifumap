<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Noto CSMapï¼ˆæ¤œç´¢ãƒ©ãƒ™ãƒ«ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿åŒæœŸãƒ»åœŸç ‚ç½å®³ãƒ»åœ°ä¾¡ã€ˆä»¤å’Œ7å¹´ã€‰ï¼‰</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@3.0.9/dist/leaflet-search.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.81.0/dist/L.Control.Locate.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
<style>
  html,body{height:100%;margin:0}
  #map{height:100%;background:#f3f3f3}
  .legend{background:#fff;padding:6px 10px;line-height:18px;box-shadow:0 0 15px rgba(0,0,0,.2)}
  .legend i{width:18px;height:18px;float:left;margin-right:8px;opacity:.9}
  .bus-icon{font-size:22px;width:26px;height:26px;line-height:26px;text-align:center;transform:translate(-13px,-13px);text-shadow:0 0 2px rgba(255,255,255,.85)}
  #msg{position:absolute;left:0;right:0;top:8px;text-align:center;color:#666;font:14px/1.6 system-ui;z-index:9999}
  .search-tag{display:inline-block;margin:6px 6px 4px 6px;padding:2px 8px;border-radius:999px;font-size:12px;color:#fff;background:#607d8b;line-height:1.4;vertical-align:middle}
</style>
</head>
<body>
<div id="map"></div>
<div id="msg">åœ°å›³ã‚’åˆæœŸåŒ–ä¸­â€¦</div>

<script>
function loadScript(src){return new Promise((ok,ng)=>{const s=document.createElement('script');s.src=src;s.onload=ok;s.onerror=ng;document.head.appendChild(s);});}
(async()=>{
  try{ await loadScript("https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"); }
  catch{ try{ await loadScript("https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"); }
         catch{ await loadScript("https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"); } }
  await loadScript("https://cdn.jsdelivr.net/npm/leaflet-search@3.0.9/dist/leaflet-search.min.js");
  await loadScript("https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.81.0/dist/L.Control.Locate.min.js");
  await loadScript("https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js");
  init();
})();

function init(){
  const msg = document.getElementById('msg'); if (msg) msg.remove();
  const map = L.map('map').setView([37.3,136.9],11);

  // --- panes ---
  map.createPane('boundaryPane');  map.getPane('boundaryPane').style.zIndex = 421;
  map.createPane('palePane');      map.getPane('palePane').style.zIndex = 425;
  map.createPane('zonesPane');     map.getPane('zonesPane').style.zIndex = 428;
  map.createPane('markersPane');   map.getPane('markersPane').style.zIndex = 430;

  // --- base layers ---
  const baseNoto = L.tileLayer('https://rinya.geospatial.jp/tile/csmaptile_noto/{z}/{x}/{y}.png',{maxZoom:18,attribution:'Â© æ—é‡åº'}).addTo(map);
  const gsiPale  = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png',{maxZoom:18,opacity:.6,pane:'palePane',attribution:'Â© å›½åœŸåœ°ç†é™¢'});
  const ctl = L.control.layers({'Noto CSMap':baseNoto},{'å›½åœŸåœ°ç†é™¢åœ°å›³':gsiPale},{collapsed:false}).addTo(map);
  L.control.scale({position:'bottomleft',imperial:false}).addTo(map);

  // ---- helpers ----
  const z2h = s => (s ?? '').toString().replace(/[ï¼-ï½]/g,ch=>String.fromCharCode(ch.charCodeAt(0)-0xFEE0)).replace(/\s+/g,' ').trim();
  const normKey = k => z2h(k).replace(/[ \t\r\n]/g,'').replace(/[ï¼\/]/g,'/').replace(/[ï¼…%]/g,'%').replace(/[ã¡m2]/g,'m2').toLowerCase();
  const pickKey = (obj, keysOrRegs) => {
    if (!obj) return '';
    const m = new Map(Object.keys(obj).map(k=>[normKey(k),k]));
    for(const k of keysOrRegs){ if(typeof k==='string'){ const nk=normKey(k); if(m.has(nk)) return obj[m.get(nk)]; } }
    const entries = Object.keys(obj).map(k=>[k,normKey(k)]);
    for(const r of keysOrRegs){ if(r instanceof RegExp){ const hit=entries.find(([,nk])=>r.test(nk)); if(hit) return obj[hit[0]]; } }
    return '';
  };
  const nf = new Intl.NumberFormat('ja-JP');
  const fmtYen = v=>{ if(v==null||v==='') return '-'; const n=Number(String(v).replace(/[,å††Â¥\s]|\/?\s*m2/gi,'')); return Number.isFinite(n)?nf.format(n)+'å††/ã¡':String(v); };
  const fmtPct = v=>{ if(v==null||v==='') return '-'; const n=Number(String(v).replace(/[,\s%ï¼…]/g,'')); return Number.isFinite(n)?n.toFixed(1)+'%':String(v); };
  const addTag=(ctrl,label,color)=>{ ctrl.options.collapsed=false; const el=ctrl._container||ctrl.getContainer();
    const tag=document.createElement('span'); tag.className='search-tag'; tag.textContent=label; if(color) tag.style.background=color;
    (el.querySelector('form')||el).insertBefore(tag,el.firstChild); return ctrl; };

  // --- ã‚¯ãƒ©ã‚¹ã‚¿ã¨å­ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å¸¸ã«åŒæœŸã•ã›ã‚‹ãƒ˜ãƒ«ãƒ‘ ---
  function registerClusterOverlay(name, srcLayer, options){
    const cluster = L.markerClusterGroup(Object.assign({
      pane:'markersPane', disableClusteringAtZoom:16, spiderfyOnMaxZoom:true, showCoverageOnHover:false
    }, options||{}));
    cluster.addLayer(srcLayer);
    // å¿µã®ãŸã‚å­ã‚’ map ã‹ã‚‰é™¤å»ï¼ˆèª¤ã£ã¦ addTo ã•ã‚ŒãŸå ´åˆã§ã‚‚æ®‹ã‚‰ãªã„ï¼‰
    if(map.hasLayer(srcLayer)) map.removeLayer(srcLayer);

    // åˆæœŸON
    map.addLayer(cluster);
    ctl.addOverlay(cluster, name);

    // ãƒˆã‚°ãƒ«æ™‚ã«å¿…ãšå­ã‚‚å¤–ã™/æˆ»ã™
    map.on('overlayremove', e => { if(e.layer===cluster){ if(map.hasLayer(srcLayer)) map.removeLayer(srcLayer); } });
    map.on('overlayadd',    e => { if(e.layer===cluster){ if(!cluster.hasLayer(srcLayer)) cluster.addLayer(srcLayer); } });

    return cluster;
  }

  // ===== å¤§å­—ï¼ˆåˆæœŸONï¼‰ =====
  fetch('./kyoukai.geojson',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const boundaryLayer = L.geoJSON(data,{
      pane:'boundaryPane',
      style:()=>({color:'green',dashArray:'4,4',weight:1.5,opacity:1}),
      onEachFeature:(f,l)=>{const p=f.properties??{}; l.options.title=z2h(`${p['å¤§å­—']??''} ${p['å¸‚ç”ºæ‘']??''}`);
        l.bindPopup(`<b>å¤§å­—:</b> ${p['å¤§å­—']??'-'}<br><b>å¸‚ç”ºæ‘:</b> ${p['å¸‚ç”ºæ‘']??'-'}`);}
    }).addTo(map);
    ctl.addOverlay(boundaryLayer,'å¤§å­—å¢ƒç•Œ');

    const s1 = new L.Control.Search({layer: boundaryLayer, propertyName:'å¤§å­—', textPlaceholder:'å¤§å­—å', marker:false, zoom:14, collapsed:false}).addTo(map);
    addTag(s1,'ğŸ“š å¤§å­—','#2e7d32');
  });

  // ===== æŒ‡å®šé¿é›£å ´æ‰€ï¼ˆåˆæœŸONãƒ»ã‚¯ãƒ©ã‚¹ã‚¿åŒæœŸï¼‰ =====
  fetch('./17000_1.geojson',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const icon = L.icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-green.png',
                         iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-35]});
    const shelters = L.geoJSON(data,{
      pane:'markersPane',
      pointToLayer:(f,latlng)=>{ const p=f.properties??{}; p._shelter_name = p['æ–½è¨­ãƒ»å ´æ‰€å'] ?? p['åç§°'] ?? '';
        const m=L.marker(latlng,{icon}); m.options.title=p._shelter_name; return m; },
      onEachFeature:(f,l)=>l.bindPopup(`<b>æŒ‡å®šé¿é›£å ´æ‰€</b><br>${Object.entries(f.properties??{}).map(([k,v])=>`<b>${k}:</b> ${v}`).join('<br>')}`)
    });
    const cluster = registerClusterOverlay('æŒ‡å®šé¿é›£å ´æ‰€ï¼ˆæ›´æ–°ï¼šä»¤å’Œ7å¹´7æœˆ9æ—¥ï¼‰', shelters);

    const s3 = new L.Control.Search({layer: shelters, propertyName:'_shelter_name', textPlaceholder:'æ–½è¨­ãƒ»å ´æ‰€å', marker:false, zoom:17, collapsed:false}).addTo(map);
    addTag(s3,'ğŸ  é¿é›£æ‰€','#388e3c');
    s3.on('search:locationfound', e=>{ if(e.latlng) map.setView(e.latlng, Math.max(map.getZoom(),17)); if(e.layer.openPopup) e.layer.openPopup(); });
  });

  // ===== ãŸã‚æ± ï¼ˆåˆæœŸONãƒ»ã‚¯ãƒ©ã‚¹ã‚¿åŒæœŸï¼‰ =====
  fetch('./ãŸã‚æ± .geojson',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const icon = L.icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-blue.png',
                         iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-35]});
    const ponds = L.geoJSON(data,{
      pane:'markersPane',
      pointToLayer:(f,latlng)=>{ const p=f.properties??{}; p._pond_name = p.name ?? p['åç§°'] ?? p['Name'] ?? '';
        const m=L.marker(latlng,{icon}); m.options.title=p._pond_name; return m; },
      onEachFeature:(f,l)=>{ const p=f.properties??{}, nm=p._pond_name ?? ''; const skip=new Set(['name','åç§°','Name']);
        const rest=Object.entries(p).filter(([k])=>!skip.has(k) && k!=='_pond_name').map(([k,v])=>`<b>${k}:</b> ${v}`).join('<br>');
        l.bindPopup(`<b>ãŸã‚æ± </b>${nm?`<br><b>name:</b> ${nm}`:''}${rest?`<br>${rest}`:''}`); }
    });
    registerClusterOverlay('ãŸã‚æ± ', ponds);

    const s4 = new L.Control.Search({layer: ponds, propertyName:'_pond_name', textPlaceholder:'ãŸã‚æ± å', marker:false, zoom:18, collapsed:false}).addTo(map);
    addTag(s4,'ğŸ’§ ãŸã‚æ± ','#1976d2');
    s4.on('search:locationfound', e=>{ if(e.latlng) map.setView(e.latlng, Math.max(map.getZoom(),18)); if(e.layer.openPopup) e.layer.openPopup(); });
  });

  // ===== ãƒã‚¹åœï¼ˆåˆæœŸONãƒ»ã‚¯ãƒ©ã‚¹ã‚¿åŒæœŸï¼‰ =====
  fetch('./P11-22_17.geojson?_=now',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const ic = L.divIcon({html:'ğŸšŒ',className:'bus-icon',iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-12]});
    const pickName = (p)=>{const ks=['åç§°','åœç•™æ‰€å','ãƒã‚¹åœå','name','Name','åœå','åœç•™æ‰€']; for(const k of ks){ if(p&&p[k]) return z2h(p[k]);} for(const [k,v] of Object.entries(p??{})){ if(typeof v==='string'&&v.trim()) return z2h(v);} return '';};
    const buses = L.geoJSON(data,{
      pane:'markersPane',
      pointToLayer:(f,latlng)=>{ const p=f.properties??{}; p._bus_name = pickName(p); const m=L.marker(latlng,{icon:ic}); m.options.title=p._bus_name; return m; },
      onEachFeature:(f,l)=>{ const p=f.properties??{}, n=p._bus_name ?? ''; const skip=new Set(['åç§°','åœç•™æ‰€å','ãƒã‚¹åœå','name','Name','åœå','åœç•™æ‰€']);
        const rest=Object.entries(p).filter(([k])=>!skip.has(k) && k!=='_bus_name').map(([k,v])=>`<b>${k}:</b> ${v}`).join('<br>');
        l.bindPopup(`<b>ãƒã‚¹åœï¼ˆä»¤å’Œ4å¹´ï¼‰</b>${n?`<br><b>åç§°:</b> ${n}`:''}${rest?`<br>${rest}`:''}`); }
    });
    registerClusterOverlay('ãƒã‚¹åœï¼ˆä»¤å’Œ4å¹´ï¼‰', buses);

    const s5 = new L.Control.Search({layer: buses, propertyName:'_bus_name', textPlaceholder:'ãƒã‚¹åœå', marker:false, zoom:18, collapsed:false}).addTo(map);
    addTag(s5,'ğŸšŒ ãƒã‚¹åœ','#6a1b9a');
    s5.on('search:locationfound', e=>{ if(e.latlng) map.setView(e.latlng, Math.max(map.getZoom(),18)); if(e.layer.openPopup) e.layer.openPopup(); });
  });

  // ===== åœ°ä¾¡ï¼ˆä»¤å’Œ7å¹´ãƒ»çŸ³å·ï¼æ¤œç´¢UIãªã—ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿åŒæœŸï¼‰ =====
  fetch('./çŸ³å·åœ°ä¾¡2025.geojson?_=r7',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const icon = L.icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-orange.png',
                         shadowUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-shadow.png',
                         iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-35]});
    const land = L.geoJSON(data,{
      pane:'markersPane',
      pointToLayer:(f,latlng)=>{
        const p=f.properties??{};
        const city  = pickKey(p,['å¸‚åŒºç”ºæ‘å','å¸‚ç”ºæ‘','å¸‚åŒºç”ºæ‘','åŸºæº–åœ°ã®åœ°å','æ‰€åœ¨åœ°å¸‚åŒºç”ºæ‘',/å¸‚åŒºç”ºæ‘/]);
        const where = pickKey(p,['æ‰€åœ¨åœ°','æ‰€åœ¨åœ°ä¸¦ã³ã«åœ°ç•ª','ä½å±…è¡¨ç¤º','åœ°ç•ª','åœ°ç‚¹å','åœ°åŒºå',/æ‰€åœ¨åœ°/]);
        const no    = pickKey(p,['æ¨™æº–åœ°ç•ªå·','æ¨™æº–åœ°ç•ªå·ï¼ˆã‚³ãƒ¼ãƒ‰ï¼‰','åœ°ç‚¹ç•ªå·','ç•ªå·',/æ¨™æº–åœ°/]);
        p._label = z2h([city,(where||no)].filter(Boolean).join(' ')) || z2h(no) || z2h(where) || 'åœ°ä¾¡èª¿æŸ»åœ°ç‚¹';
        const m=L.marker(latlng,{icon}); m.options.title=p._label; return m;
      },
      onEachFeature:(f,l)=>{
        const p=f.properties??{};
        const price = fmtYen(pickKey(p,['ä¾¡æ ¼','ä¾¡æ ¼ï¼ˆå††/ã¡ï¼‰','ä¾¡æ ¼_å††m2','ä¾¡æ ¼_å††ï¼ã¡','å˜ä¾¡','price','å††/m2','å††ï¼m2','å††/ã¡','å††ï¼ã¡','å††m2',/å††.?m2/]));
        const yoy   = fmtPct(pickKey(p,['å¯¾å‰å¹´å¤‰å‹•ç‡','å¯¾å‰å¹´å¤‰å‹•ç‡ï¼ˆï¼…ï¼‰','å¯¾å‰å¹´å¤‰å‹•ç‡%','å¯¾å‰å¹´å¤‰å‹•ç‡ï¼…','å¤‰å‹•ç‡','å‰å¹´æ¯”','å‰å¹´æ¯”ï¼…','yoy',/å¯¾å‰å¹´.*å¤‰å‹•ç‡/,/å‰å¹´æ¯”/]));
        const use   = pickKey(p,['ç”¨é€”','ç”¨é€”åŒºåˆ†','åŒºåˆ†','ç”¨é€”åœ°åŸŸ',/ç”¨é€”/]);
        const city  = pickKey(p,['å¸‚åŒºç”ºæ‘å','å¸‚ç”ºæ‘','å¸‚åŒºç”ºæ‘','åŸºæº–åœ°ã®åœ°å','æ‰€åœ¨åœ°å¸‚åŒºç”ºæ‘',/å¸‚åŒºç”ºæ‘/]);
        const where = pickKey(p,['æ‰€åœ¨åœ°','æ‰€åœ¨åœ°ä¸¦ã³ã«åœ°ç•ª','ä½å±…è¡¨ç¤º','åœ°ç•ª','åœ°ç‚¹å','åœ°åŒºå',/æ‰€åœ¨åœ°/]);
        const no    = pickKey(p,['æ¨™æº–åœ°ç•ªå·','æ¨™æº–åœ°ç•ªå·ï¼ˆã‚³ãƒ¼ãƒ‰ï¼‰','åœ°ç‚¹ç•ªå·','ç•ªå·',/æ¨™æº–åœ°/]);
        const note  = pickKey(p,['å‚™è€ƒ','æ³¨è¨˜','ãƒ¡ãƒ¢']);
        let html =
          `<b>åœ°ä¾¡èª¿æŸ»ï¼ˆä»¤å’Œ7å¹´ï¼‰</b><br>`+
          `<b>æ¨™æº–åœ°ç•ªå·:</b> ${no||'-'}<br>`+
          `<b>æ‰€åœ¨åœ°:</b> ${[city,where].filter(Boolean).join(' ')||'-'}<br>`+
          `<b>ç”¨é€”:</b> ${use||'-'}<br>`+
          `<b>ä¾¡æ ¼:</b> ${price}<br>`+
          `<b>å¯¾å‰å¹´å¤‰å‹•ç‡:</b> ${yoy}`;
        if(price==='-'&&yoy==='-'&&!no&&!city&&!where){
          const rows=Object.entries(p).map(([k,v])=>`<tr><th style="text-align:left;padding-right:6px;">${k}</th><td>${v}</td></tr>`).join('');
          html+=`<br><div style="max-height:240px;overflow:auto;"><table>${rows}</table></div>`;
        }
        if(note) html+=`<br><b>å‚™è€ƒ:</b> ${note}`;
        l.bindPopup(html);
      }
    });
    registerClusterOverlay('åœ°ä¾¡èª¿æŸ»ï¼ˆä»¤å’Œ7å¹´ãƒ»çŸ³å·ï¼‰', land);
  });

  // ===== åœŸç ‚ç½å®³ï¼ˆåˆæœŸONãƒ»ä¸€ç•ªä¸‹ï¼‰ =====
  fetch('./dosya.geojson',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const col=v=>(v==1||v==='1')?'#ffff00':(v==2||v==='2')?'#ff0000':'#888';
    const nm=v=>(v==1||v==='1')?'ã‚¤ã‚¨ãƒ­ãƒ¼ã‚¾ãƒ¼ãƒ³':(v==2||v==='2')?'ãƒ¬ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³':'ãã®ä»–';
    const danger = L.geoJSON(data,{
      pane:'zonesPane',
      style:f=>({color:col(f.properties.A33_002),weight:2,opacity:.9,fillOpacity:.25}),
      onEachFeature:(f,l)=>{
        const p=f.properties??{}; const num=(p.A33_004??'').toString().split(/[-ï¼â€•â€]/)[0].replace(/\D/g,''); const name=(p.A33_005??'').toString();
        l.options.title=`${num} ${name}`.trim();
        l.bindPopup(`<b>${nm(p.A33_002)}</b><br><b>ç®‡æ‰€ç•ªå·:</b> ${p.A33_004??'-'}<br><b>ç®‡æ‰€å:</b> ${p.A33_005??'-'}`+(p.A33_009?`<br><b>å¸‚ç”ºæ‘:</b> ${p.A33_009}`:''));
      }
    }).addTo(map);
    ctl.addOverlay(danger,'åœŸç ‚ç½å®³è­¦æˆ’åŒºåŸŸ');

    const s2 = new L.Control.Search({layer: danger, propertyName:'title', textPlaceholder:'ç®‡æ‰€ç•ªå· / ç®‡æ‰€å', marker:false, zoom:16, collapsed:false}).addTo(map);
    addTag(s2,'âš ï¸ åœŸç ‚ç½å®³','#e53935');
  });

  // å‡¡ä¾‹
  const legend=L.control({position:'bottomright'});
  legend.onAdd=()=>{const d=L.DomUtil.create('div','legend'); d.innerHTML =
    '<i style="background:#ffff00;"></i> ã‚¤ã‚¨ãƒ­ãƒ¼ã‚¾ãƒ¼ãƒ³<br>'+
    '<i style="background:#ff0000;"></i> ãƒ¬ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³<br>'+
    '<img src="https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-green.png" style="height:18px;vertical-align:middle;margin-right:6px;"> æŒ‡å®šé¿é›£å ´æ‰€ï¼ˆä»¤å’Œ7å¹´7æœˆ9æ—¥ï¼‰<br>'+
    '<img src="https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-blue.png" style="height:18px;vertical-align:middle;margin-right:6px;"> ãŸã‚æ± <br>'+
    '<span style="font-size:18px;vertical-align:middle;margin-right:6px;">ğŸšŒ</span> ãƒã‚¹åœï¼ˆä»¤å’Œ4å¹´ï¼‰<br>'+
    '<img src="https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-orange.png" style="height:18px;vertical-align:middle;margin-right:6px;"> åœ°ä¾¡èª¿æŸ»ï¼ˆä»¤å’Œ7å¹´ï¼‰';
    return d;};
  legend.addTo(map);

  // ç¾åœ¨åœ°
  if(L.control.locate){ L.control.locate({position:'topleft',flyTo:true,strings:{title:'ç¾åœ¨åœ°ã‚’è¡¨ç¤º'},locateOptions:{enableHighAccuracy:true}}).addTo(map); }
}
</script>
</body>
</html>
